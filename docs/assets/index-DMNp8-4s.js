(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();class n{constructor(e,t,s="blue"){this.x=e,this.y=t,this.color=s}}class c{rows;cols;cellSize;cursorX=0;cursorY=0;pieces=[];selectedPiece=null;draggingPiece=null;dragOffsetX=0;dragOffsetY=0;constructor(e,t,s){this.rows=e,this.cols=t,this.cellSize=s}addPiece(e){this.pieces.push(e)}moveCursor(e,t){this.cursorX=Math.max(0,Math.min(this.cols-1,this.cursorX+e)),this.cursorY=Math.max(0,Math.min(this.rows-1,this.cursorY+t))}setCursorByPixel(e,t){const{x:s,y:i}=this.pixelToCell(e,t);this.cursorX=Math.max(0,Math.min(this.cols-1,s)),this.cursorY=Math.max(0,Math.min(this.rows-1,i))}drawCursor(e){const{px:t,py:s}=this.cellToPixel(this.cursorX,this.cursorY);e.fillStyle="red",e.fillRect(t+2,s+2,this.cellSize-4,this.cellSize-4)}draw(e){e.strokeStyle="#555";for(let t=0;t<=this.rows;t++)e.beginPath(),e.moveTo(0,t*this.cellSize),e.lineTo(this.cols*this.cellSize,t*this.cellSize),e.stroke();for(let t=0;t<=this.cols;t++)e.beginPath(),e.moveTo(t*this.cellSize,0),e.lineTo(t*this.cellSize,this.rows*this.cellSize),e.stroke();for(const t of this.pieces){let s=t.x*this.cellSize,i=t.y*this.cellSize;t===this.draggingPiece&&(s=this.dragX-this.dragOffsetX,i=this.dragY-this.dragOffsetY),e.fillStyle=t.color,e.beginPath(),e.arc(s+this.cellSize/2,i+this.cellSize/2,this.cellSize/3,0,Math.PI*2),e.fill()}this.drawCursor(e)}cellToPixel(e,t){return{px:e*this.cellSize,py:t*this.cellSize}}pixelToCell(e,t){return{x:Math.floor(e/this.cellSize),y:Math.floor(t/this.cellSize)}}dragX=0;dragY=0;handleMouseDown(e,t){const{x:s,y:i}=this.pixelToCell(e,t),o=this.pieces.find(r=>r.x===s&&r.y===i);o?(this.draggingPiece=o,this.dragOffsetX=e-o.x*this.cellSize,this.dragOffsetY=t-o.y*this.cellSize):this.selectedPiece=null}handleMouseMove(e,t){this.draggingPiece&&(this.dragX=e,this.dragY=t)}handleMouseUp(e,t){if(this.draggingPiece){const{x:s,y:i}=this.pixelToCell(e,t);this.draggingPiece.x=Math.max(0,Math.min(this.cols-1,s)),this.draggingPiece.y=Math.max(0,Math.min(this.rows-1,i)),this.draggingPiece=null}}handleClick(e,t){const{x:s,y:i}=this.pixelToCell(e,t),o=this.pieces.find(r=>r.x===s&&r.y===i);this.selectedPiece?o?o===this.selectedPiece?this.selectedPiece=null:this.selectedPiece=o:(this.selectedPiece.x=s,this.selectedPiece.y=i,this.selectedPiece=null):o&&(this.selectedPiece=o),this.cursorX=s,this.cursorY=i}}class d{keys=new Set;constructor(){window.addEventListener("keydown",e=>this.keys.add(e.key)),window.addEventListener("keyup",e=>this.keys.delete(e.key))}isPressed(e){return this.keys.has(e)}}class a{x=0;y=0;pressed=!1;onMouseDown=null;onMouseMove=null;onMouseUp=null;onClick=null;constructor(e){e.addEventListener("mousemove",t=>{const s=e.getBoundingClientRect();this.x=t.clientX-s.left,this.y=t.clientY-s.top,this.onMouseMove&&this.onMouseMove(this.x,this.y)}),e.addEventListener("mousedown",t=>{this.pressed=!0;const s=e.getBoundingClientRect(),i=t.clientX-s.left,o=t.clientY-s.top;this.onMouseDown&&this.onMouseDown(i,o)}),e.addEventListener("mouseup",t=>{this.pressed=!1;const s=e.getBoundingClientRect(),i=t.clientX-s.left,o=t.clientY-s.top;this.onMouseUp&&this.onMouseUp(i,o)}),e.addEventListener("click",t=>{const s=e.getBoundingClientRect(),i=t.clientX-s.left,o=t.clientY-s.top;this.onClick&&this.onClick(i,o)})}}class u{constructor(e){this.canvas=e,this.ctx=e.getContext("2d"),this.board=new c(8,8,64),this.board.addPiece(new n(0,0,"blue")),this.board.addPiece(new n(3,3,"green")),this.board.addPiece(new n(5,2,"orange")),this.keyboard=new d,this.mouse=new a(e),this.mouse.onMouseDown=(t,s)=>this.board.handleMouseDown(t,s),this.mouse.onMouseMove=(t,s)=>this.board.handleMouseMove(t,s),this.mouse.onMouseUp=(t,s)=>this.board.handleMouseUp(t,s),this.start()}lastTime=0;ctx;board;keyboard;mouse;start(){requestAnimationFrame(this.loop)}loop=e=>{const t=e-this.lastTime;this.lastTime=e,this.update(t),this.render(),requestAnimationFrame(this.loop)};update(e){this.keyboard.isPressed("ArrowUp")&&this.board.moveCursor(0,-1),this.keyboard.isPressed("ArrowDown")&&this.board.moveCursor(0,1),this.keyboard.isPressed("ArrowLeft")&&this.board.moveCursor(-1,0),this.keyboard.isPressed("ArrowRight")&&this.board.moveCursor(1,0)}render(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.board.draw(this.ctx)}}const h=document.getElementById("game");h.width=window.innerWidth;h.height=window.innerHeight;const f=new u(h);f.start();
